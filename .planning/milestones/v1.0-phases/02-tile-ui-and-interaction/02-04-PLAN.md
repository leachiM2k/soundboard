---
phase: 02-tile-ui-and-interaction
plan: "04"
type: execute
wave: 4
depends_on: ["02-03"]
files_modified: []
autonomous: false
requirements: [GRID-01, GRID-02, REC-03, MGMT-01, MGMT-02, PLAY-03]

must_haves:
  truths:
    - "9 tiles fill exactly one iPhone screen — no scrolling, no overflow, no cut-off tiles"
    - "Empty and filled tiles are visually distinct at a glance on the real device"
    - "Tapping a tile produces a haptic tap on iPhone (iOS 17.4+)"
    - "Recording tile shows pulsing red glow and live elapsed/remaining timer"
    - "Long-pressing a filled tile opens action sheet from the bottom"
    - "Delete removes recording and resets tile"
    - "Rename persists across app restart"
  artifacts:
    - path: ".planning/phases/02-tile-ui-and-interaction/02-04-SUMMARY.md"
      provides: "Verification record with pass/fail per test case"
  key_links:
    - from: "iPhone Safari"
      to: "https://<ngrok-url>"
      via: "ngrok tunnel for HTTPS on real device"
      pattern: "ngrok"
---

<objective>
iPhone Safari verification: confirm all Phase 2 requirements work correctly on a real iPhone.

Purpose: Desktop browser testing cannot catch iOS-specific issues (dvh layout, haptic feedback, action sheet animation, touch event behaviour). This checkpoint catches those issues before Phase 3.
Output: Verified Phase 2 feature set on real iPhone Safari. Issues documented and fixed inline.
</objective>

<execution_context>
@/Users/rotmanov/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rotmanov/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02-tile-ui-and-interaction/02-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:setup">
  <name>Task 1: Start dev server and open ngrok tunnel</name>
  <files></files>
  <action>
    Start the Vite dev server with HTTPS and host flag, then open an ngrok tunnel.

    The memory file confirms ngrok is the established iPhone testing method for this project (avoids certificate warnings with `@vitejs/plugin-basic-ssl` self-signed certs).

    Run in background terminal 1:
    ```
    npm run dev -- --host
    ```

    Run in background terminal 2:
    ```
    ngrok http https://localhost:5173 --host-header=localhost
    ```

    Note: The `vite.config.ts` already has `allowedHosts` configured to permit ngrok domains (from Phase 1 setup per MEMORY.md). If `allowedHosts` is not set for ngrok, add to vite.config.ts:
    ```typescript
    server: {
      allowedHosts: ['all'],  // or the specific ngrok domain pattern
    }
    ```

    Provide the ngrok HTTPS URL to the user for iPhone testing.
  </action>
  <verify>
    ngrok is running and shows a Forwarding URL (https://xxxx.ngrok-free.app or similar).
    `npm run dev` is serving on https://localhost:5173.
  </verify>
  <done>Dev server and ngrok tunnel are running. HTTPS URL is available for iPhone testing.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: iPhone Safari verification — all Phase 2 requirements</name>
  <files></files>
  <action>Human verifies all Phase 2 features on real iPhone Safari via ngrok HTTPS URL (see how-to-verify below).</action>
  <verify>All 9 test cases pass on iPhone Safari.</verify>
  <done>User confirms "approved" after running all tests.</done>
  <what-built>
    Complete Phase 2 UI: 3x3 tile grid, tile visual states (empty/filled/recording/saving/playing/error), pulsing recording indicator, live recording timer, haptic feedback, long-press action sheet (Re-record / Rename / Delete), rename dialog with IndexedDB persistence.
  </what-built>
  <how-to-verify>
    Open the ngrok HTTPS URL on your iPhone in Safari. Run through these tests in order:

    **Test 1 — Grid layout (GRID-01)**
    - App loads and shows exactly 9 tiles in a 3x3 grid
    - No scrolling is possible; all 9 tiles visible at once
    - Tiles fill the screen nicely — not too small, no overflow below the home bar
    - PASS if: 9 tiles visible, no scroll, home bar not covered

    **Test 2 — Empty vs filled distinction (GRID-02)**
    - Empty tiles are dark with a dashed border and mic icon
    - Record a sound on one tile (tap → speak → tap to stop)
    - Filled tile now shows a distinct accent color (bold, colorful) with a play icon and label
    - PASS if: visual difference is obvious at a glance

    **Test 3 — Haptic feedback (PLAY-03)**
    - Tap any tile with the iPhone muted (not silent mode — volume up but muted via software is fine)
    - Feel a brief haptic tap on iPhone 17.4+ (or recent device)
    - PASS if: haptic fires on tap (no vibration on older devices is acceptable)

    **Test 4 — Recording indicator (REC-03)**
    - Tap an empty tile to start recording
    - Tile shows a pulsing red glow and a live timer (e.g., 0:05 / 0:25 remaining)
    - Timer counts up (elapsed) and remaining counts down from 0:30
    - PASS if: animation visible, timer updates every ~200ms

    **Test 5 — Long-press action sheet (MGMT-01, MGMT-02)**
    - Long-press (hold ~0.5s) a filled tile
    - Action sheet slides up from the bottom
    - Shows: tile name in header, Neu aufnehmen (Re-record), Umbenennen (Rename), Löschen (red), Abbrechen (Cancel)
    - PASS if: sheet appears, button order correct, tapping outside closes it

    **Test 6 — Delete (MGMT-02)**
    - Long-press a filled tile → tap Löschen
    - Tile immediately returns to empty state (dark, mic icon)
    - Reload the page — tile is still empty (deleted from IndexedDB)
    - PASS if: immediate UI update + persistence

    **Test 7 — Re-record (MGMT-02)**
    - Long-press a filled tile → tap Neu aufnehmen
    - Recording starts immediately on that tile
    - PASS if: tile enters recording state, mic opens, sound can be re-recorded

    **Test 8 — Rename (MGMT-02)**
    - Long-press a filled tile → tap Umbenennen
    - Rename dialog appears centered on screen, keyboard opens
    - Type a new name, tap Speichern
    - Tile label updates immediately
    - Reload page — label persists
    - PASS if: keyboard opens, label visible on tile, persists across reload

    **Test 9 — Phase 1 regression check**
    - Tap a filled tile → plays audio
    - Tap playing tile → stops and restarts from beginning
    - PASS if: audio still works correctly with new UI

    Note any issues observed even if test passes (e.g., animation jank, dialog animation snap, timer offset).
  </how-to-verify>
  <resume-signal>Type "approved" if all 9 tests pass. Or describe any failures with which test number failed and what you observed.</resume-signal>
</task>

</tasks>

<verification>
All 9 iPhone Safari tests pass. Phase 2 requirements GRID-01, GRID-02, REC-03, MGMT-01, MGMT-02, PLAY-03 verified on real device.
</verification>

<success_criteria>
User types "approved" after running all 9 tests on iPhone Safari. Any failures are diagnosed and fixed inline before approval is granted. Phase 2 is complete and Phase 3 (PWA Shell and Offline) can begin.
</success_criteria>

<output>
After completion, create `.planning/phases/02-tile-ui-and-interaction/02-04-SUMMARY.md` using the summary template. Include the test results table.

Also update:
- `.planning/STATE.md` — Phase 2 complete, ready for Phase 3
- `.planning/ROADMAP.md` — mark Phase 2 plans as complete
- `.planning/REQUIREMENTS.md` — mark GRID-01, GRID-02, REC-03, MGMT-01, MGMT-02, PLAY-03 as complete
</output>
